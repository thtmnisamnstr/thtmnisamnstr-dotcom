# This is a basic workflow to help you get started with Actions

# Gavin, 20200802: Added GitHub Action for Gatsby CLI
- name: Github Action for Gatsby CLI
  uses: jzweifel/gatsby-cli-github-action@v1.0.0

# Gavin, 20200802: Added GitHub Action for Firebase
- name: GitHub Action for Firebase
  uses: w9jds/firebase-action@v1.5.0


- name: Build and Deploy
  # Controls when the action will run. Triggers the workflow on push or pull request
  # events but only for the main branch
  on:
    # Gavin, 20200802: Removing on-push, because I only want PRs to trigger this job
    #push:
    #  branches: [ main ]
    pull_request:
      branches: [ main ]

  # A workflow run is made up of one or more jobs that can run sequentially or in parallel
  jobs:
    # This workflow contains a two jobs, "build" and "deploy"
    build:
      name: Build
      runs-on: ubuntu-latest
      steps:
      - name: Checkout Repo
        uses: actions/checkout@master
      - name: Clean Gatsby Site
        uses: jzweifel/gatsby-cli-github-action@master
        with:
          gatsby-arg: clean
      - name: Build Gatsby Site
        uses: jzweifel/gatsby-cli-github-action@master
        with:
          gatsby-arg: build
    
    deploy:
      name: Deploy
      needs: Build
      runs-on: ubuntu-latest
      steps:
        - name: Deploy to Firebase
          uses: w9jds/firebase-action@master
          with:
            args: deploy --only hosting
          env:
            FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
