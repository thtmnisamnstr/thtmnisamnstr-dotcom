"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.mergeMediaConfig = mergeMediaConfig;
exports.default = void 0;

var _styledBase = _interopRequireDefault(require("@emotion/styled-base"));

var _debounce2 = _interopRequireDefault(require("lodash/debounce"));

var _isEmpty2 = _interopRequireDefault(require("lodash/isEmpty"));

var _get2 = _interopRequireDefault(require("lodash/get"));

var _react = _interopRequireDefault(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactImmutableProptypes = _interopRequireDefault(require("react-immutable-proptypes"));

var _immutable = require("immutable");

var _core = require("@emotion/core");

var _slate = require("slate");

var _slateReact = require("slate-react");

var _netlifyCmsUiDefault = require("netlify-cms-ui-default");

var _styles = require("../styles");

var _serializers = require("../serializers");

var _Toolbar = _interopRequireDefault(require("../MarkdownControl/Toolbar"));

var _renderers = require("./renderers");

var _visual = _interopRequireDefault(require("./plugins/visual"));

var _schema = _interopRequireDefault(require("./schema"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _EMOTION_STRINGIFIED_CSS_ERROR__() { return "You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop)."; }

function visualEditorStyles({
  minimal
}) {
  return `
  position: relative;
  overflow: hidden;
  overflow-x: auto;
  font-family: ${_netlifyCmsUiDefault.fonts.primary};
  min-height: ${minimal ? 'auto' : _netlifyCmsUiDefault.lengths.richTextEditorMinHeight};
  border-top-left-radius: 0;
  border-top-right-radius: 0;
  border-top: 0;
  margin-top: -${_styles.editorStyleVars.stickyDistanceBottom};
  padding: 0;
  display: flex;
  flex-direction: column;
  z-index: ${_netlifyCmsUiDefault.zIndex.zIndex100};
`;
}

const InsertionPoint = (0, _styledBase.default)("div", {
  target: "evezps90",
  label: "InsertionPoint"
})(process.env.NODE_ENV === "production" ? {
  name: "b2d31m",
  styles: "flex:1 1 auto;cursor:text;"
} : {
  name: "b2d31m",
  styles: "flex:1 1 auto;cursor:text;",
  map: "/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9NYXJrZG93bkNvbnRyb2wvVmlzdWFsRWRpdG9yLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQW9DaUMiLCJmaWxlIjoiLi4vLi4vLi4vc3JjL01hcmtkb3duQ29udHJvbC9WaXN1YWxFZGl0b3IuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBJbW11dGFibGVQcm9wVHlwZXMgZnJvbSAncmVhY3QtaW1tdXRhYmxlLXByb3B0eXBlcyc7XG5pbXBvcnQgeyBmcm9tSlMgfSBmcm9tICdpbW11dGFibGUnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdAZW1vdGlvbi9zdHlsZWQnO1xuaW1wb3J0IHsgY3NzIGFzIGNvcmVDc3MsIENsYXNzTmFtZXMgfSBmcm9tICdAZW1vdGlvbi9jb3JlJztcbmltcG9ydCB7IGdldCwgaXNFbXB0eSwgZGVib3VuY2UgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgVmFsdWUsIERvY3VtZW50LCBCbG9jaywgVGV4dCB9IGZyb20gJ3NsYXRlJztcbmltcG9ydCB7IEVkaXRvciBhcyBTbGF0ZSB9IGZyb20gJ3NsYXRlLXJlYWN0JztcbmltcG9ydCB7IGxlbmd0aHMsIGZvbnRzLCB6SW5kZXggfSBmcm9tICduZXRsaWZ5LWNtcy11aS1kZWZhdWx0JztcblxuaW1wb3J0IHsgZWRpdG9yU3R5bGVWYXJzLCBFZGl0b3JDb250cm9sQmFyIH0gZnJvbSAnLi4vc3R5bGVzJztcbmltcG9ydCB7IHNsYXRlVG9NYXJrZG93biwgbWFya2Rvd25Ub1NsYXRlIH0gZnJvbSAnLi4vc2VyaWFsaXplcnMnO1xuaW1wb3J0IFRvb2xiYXIgZnJvbSAnLi4vTWFya2Rvd25Db250cm9sL1Rvb2xiYXInO1xuaW1wb3J0IHsgcmVuZGVyQmxvY2ssIHJlbmRlcklubGluZSwgcmVuZGVyTWFyayB9IGZyb20gJy4vcmVuZGVyZXJzJztcbmltcG9ydCBwbHVnaW5zIGZyb20gJy4vcGx1Z2lucy92aXN1YWwnO1xuaW1wb3J0IHNjaGVtYSBmcm9tICcuL3NjaGVtYSc7XG5cbmZ1bmN0aW9uIHZpc3VhbEVkaXRvclN0eWxlcyh7IG1pbmltYWwgfSkge1xuICByZXR1cm4gYFxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIG92ZXJmbG93OiBoaWRkZW47XG4gIG92ZXJmbG93LXg6IGF1dG87XG4gIGZvbnQtZmFtaWx5OiAke2ZvbnRzLnByaW1hcnl9O1xuICBtaW4taGVpZ2h0OiAke21pbmltYWwgPyAnYXV0bycgOiBsZW5ndGhzLnJpY2hUZXh0RWRpdG9yTWluSGVpZ2h0fTtcbiAgYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogMDtcbiAgYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IDA7XG4gIGJvcmRlci10b3A6IDA7XG4gIG1hcmdpbi10b3A6IC0ke2VkaXRvclN0eWxlVmFycy5zdGlja3lEaXN0YW5jZUJvdHRvbX07XG4gIHBhZGRpbmc6IDA7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gIHotaW5kZXg6ICR7ekluZGV4LnpJbmRleDEwMH07XG5gO1xufVxuXG5jb25zdCBJbnNlcnRpb25Qb2ludCA9IHN0eWxlZC5kaXZgXG4gIGZsZXg6IDEgMSBhdXRvO1xuICBjdXJzb3I6IHRleHQ7XG5gO1xuXG5mdW5jdGlvbiBjcmVhdGVFbXB0eVJhd0RvYygpIHtcbiAgY29uc3QgZW1wdHlUZXh0ID0gVGV4dC5jcmVhdGUoJycpO1xuICBjb25zdCBlbXB0eUJsb2NrID0gQmxvY2suY3JlYXRlKHsgb2JqZWN0OiAnYmxvY2snLCB0eXBlOiAncGFyYWdyYXBoJywgbm9kZXM6IFtlbXB0eVRleHRdIH0pO1xuICByZXR1cm4geyBub2RlczogW2VtcHR5QmxvY2tdIH07XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVNsYXRlVmFsdWUocmF3VmFsdWUsIHsgdm9pZENvZGVCbG9jaywgcmVtYXJrUGx1Z2lucyB9KSB7XG4gIGNvbnN0IHJhd0RvYyA9IHJhd1ZhbHVlICYmIG1hcmtkb3duVG9TbGF0ZShyYXdWYWx1ZSwgeyB2b2lkQ29kZUJsb2NrLCByZW1hcmtQbHVnaW5zIH0pO1xuICBjb25zdCByYXdEb2NIYXNOb2RlcyA9ICFpc0VtcHR5KGdldChyYXdEb2MsICdub2RlcycpKTtcbiAgY29uc3QgZG9jdW1lbnQgPSBEb2N1bWVudC5mcm9tSlNPTihyYXdEb2NIYXNOb2RlcyA/IHJhd0RvYyA6IGNyZWF0ZUVtcHR5UmF3RG9jKCkpO1xuICByZXR1cm4gVmFsdWUuY3JlYXRlKHsgZG9jdW1lbnQgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtZXJnZU1lZGlhQ29uZmlnKGVkaXRvckNvbXBvbmVudHMsIGZpZWxkKSB7XG4gIC8vIG1lcmdlIGVkaXRvciBtZWRpYSBsaWJyYXJ5IGNvbmZpZyB0byBpbWFnZSBjb21wb25lbnRzXG4gIGlmIChlZGl0b3JDb21wb25lbnRzLmhhcygnaW1hZ2UnKSkge1xuICAgIGNvbnN0IGltYWdlQ29tcG9uZW50ID0gZWRpdG9yQ29tcG9uZW50cy5nZXQoJ2ltYWdlJyk7XG4gICAgY29uc3QgZmllbGRzID0gaW1hZ2VDb21wb25lbnQ/LmZpZWxkcztcblxuICAgIGlmIChmaWVsZHMpIHtcbiAgICAgIGltYWdlQ29tcG9uZW50LmZpZWxkcyA9IGZpZWxkcy51cGRhdGUoXG4gICAgICAgIGZpZWxkcy5maW5kSW5kZXgoZiA9PiBmLmdldCgnd2lkZ2V0JykgPT09ICdpbWFnZScpLFxuICAgICAgICBmID0+IHtcbiAgICAgICAgICAvLyBtZXJnZSBgbWVkaWFfbGlicmFyeWAgY29uZmlnXG4gICAgICAgICAgaWYgKGZpZWxkLmhhcygnbWVkaWFfbGlicmFyeScpKSB7XG4gICAgICAgICAgICBmID0gZi5zZXQoXG4gICAgICAgICAgICAgICdtZWRpYV9saWJyYXJ5JyxcbiAgICAgICAgICAgICAgZmllbGQuZ2V0KCdtZWRpYV9saWJyYXJ5JykubWVyZ2VEZWVwKGYuZ2V0KCdtZWRpYV9saWJyYXJ5JykpLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gbWVyZ2UgJ21lZGlhX2ZvbGRlcidcbiAgICAgICAgICBpZiAoZmllbGQuaGFzKCdtZWRpYV9mb2xkZXInKSAmJiAhZi5oYXMoJ21lZGlhX2ZvbGRlcicpKSB7XG4gICAgICAgICAgICBmID0gZi5zZXQoJ21lZGlhX2ZvbGRlcicsIGZpZWxkLmdldCgnbWVkaWFfZm9sZGVyJykpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBtZXJnZSAncHVibGljX2ZvbGRlcidcbiAgICAgICAgICBpZiAoZmllbGQuaGFzKCdwdWJsaWNfZm9sZGVyJykgJiYgIWYuaGFzKCdwdWJsaWNfZm9sZGVyJykpIHtcbiAgICAgICAgICAgIGYgPSBmLnNldCgncHVibGljX2ZvbGRlcicsIGZpZWxkLmdldCgncHVibGljX2ZvbGRlcicpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGY7XG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFZGl0b3IgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcbiAgICBjb25zdCBlZGl0b3JDb21wb25lbnRzID0gcHJvcHMuZ2V0RWRpdG9yQ29tcG9uZW50cygpO1xuICAgIHRoaXMuc2hvcnRjb2RlQ29tcG9uZW50cyA9IGVkaXRvckNvbXBvbmVudHMuZmlsdGVyKCh7IHR5cGUgfSkgPT4gdHlwZSA9PT0gJ3Nob3J0Y29kZScpO1xuICAgIHRoaXMuY29kZUJsb2NrQ29tcG9uZW50ID0gZnJvbUpTKGVkaXRvckNvbXBvbmVudHMuZmluZCgoeyB0eXBlIH0pID0+IHR5cGUgPT09ICdjb2RlLWJsb2NrJykpO1xuICAgIHRoaXMuZWRpdG9yQ29tcG9uZW50cyA9XG4gICAgICB0aGlzLmNvZGVCbG9ja0NvbXBvbmVudCB8fCBlZGl0b3JDb21wb25lbnRzLmhhcygnY29kZS1ibG9jaycpXG4gICAgICAgID8gZWRpdG9yQ29tcG9uZW50c1xuICAgICAgICA6IGVkaXRvckNvbXBvbmVudHMuc2V0KCdjb2RlLWJsb2NrJywgeyBsYWJlbDogJ0NvZGUgQmxvY2snLCB0eXBlOiAnY29kZS1ibG9jaycgfSk7XG5cbiAgICB0aGlzLnJlbWFya1BsdWdpbnMgPSBwcm9wcy5nZXRSZW1hcmtQbHVnaW5zKCk7XG5cbiAgICBtZXJnZU1lZGlhQ29uZmlnKHRoaXMuZWRpdG9yQ29tcG9uZW50cywgdGhpcy5wcm9wcy5maWVsZCk7XG4gICAgdGhpcy5yZW5kZXJCbG9jayA9IHJlbmRlckJsb2NrKHtcbiAgICAgIGNsYXNzTmFtZVdyYXBwZXI6IHByb3BzLmNsYXNzTmFtZSxcbiAgICAgIHJlc29sdmVXaWRnZXQ6IHByb3BzLnJlc29sdmVXaWRnZXQsXG4gICAgICBjb2RlQmxvY2tDb21wb25lbnQ6IHRoaXMuY29kZUJsb2NrQ29tcG9uZW50LFxuICAgIH0pO1xuICAgIHRoaXMucmVuZGVySW5saW5lID0gcmVuZGVySW5saW5lKCk7XG4gICAgdGhpcy5yZW5kZXJNYXJrID0gcmVuZGVyTWFyaygpO1xuICAgIHRoaXMuc2NoZW1hID0gc2NoZW1hKHsgdm9pZENvZGVCbG9jazogISF0aGlzLmNvZGVCbG9ja0NvbXBvbmVudCB9KTtcbiAgICB0aGlzLnBsdWdpbnMgPSBwbHVnaW5zKHtcbiAgICAgIGdldEFzc2V0OiBwcm9wcy5nZXRBc3NldCxcbiAgICAgIHJlc29sdmVXaWRnZXQ6IHByb3BzLnJlc29sdmVXaWRnZXQsXG4gICAgICB0OiBwcm9wcy50LFxuICAgICAgcmVtYXJrUGx1Z2luczogdGhpcy5yZW1hcmtQbHVnaW5zLFxuICAgIH0pO1xuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICB2YWx1ZTogY3JlYXRlU2xhdGVWYWx1ZSh0aGlzLnByb3BzLnZhbHVlLCB7XG4gICAgICAgIHZvaWRDb2RlQmxvY2s6ICEhdGhpcy5jb2RlQmxvY2tDb21wb25lbnQsXG4gICAgICAgIHJlbWFya1BsdWdpbnM6IHRoaXMucmVtYXJrUGx1Z2lucyxcbiAgICAgIH0pLFxuICAgIH07XG4gIH1cblxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIG9uQWRkQXNzZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgZ2V0QXNzZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25DaGFuZ2U6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25Nb2RlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIHZhbHVlOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGZpZWxkOiBJbW11dGFibGVQcm9wVHlwZXMubWFwLmlzUmVxdWlyZWQsXG4gICAgZ2V0RWRpdG9yQ29tcG9uZW50czogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBnZXRSZW1hcmtQbHVnaW5zOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGlzU2hvd01vZGVUb2dnbGU6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsXG4gICAgdDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgfTtcblxuICBzaG91bGRDb21wb25lbnRVcGRhdGUobmV4dFByb3BzLCBuZXh0U3RhdGUpIHtcbiAgICBpZiAoIXRoaXMuc3RhdGUudmFsdWUuZXF1YWxzKG5leHRTdGF0ZS52YWx1ZSkpIHJldHVybiB0cnVlO1xuXG4gICAgY29uc3QgcmF3ID0gbmV4dFN0YXRlLnZhbHVlLmRvY3VtZW50LnRvSlMoKTtcbiAgICBjb25zdCBtYXJrZG93biA9IHNsYXRlVG9NYXJrZG93bihyYXcsIHtcbiAgICAgIHZvaWRDb2RlQmxvY2s6IHRoaXMuY29kZUJsb2NrQ29tcG9uZW50LFxuICAgICAgcmVtYXJrUGx1Z2luczogdGhpcy5yZW1hcmtQbHVnaW5zLFxuICAgIH0pO1xuICAgIHJldHVybiBuZXh0UHJvcHMudmFsdWUgIT09IG1hcmtkb3duO1xuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgaWYgKHRoaXMucHJvcHMucGVuZGluZ0ZvY3VzKSB7XG4gICAgICB0aGlzLmVkaXRvci5mb2N1cygpO1xuICAgICAgdGhpcy5wcm9wcy5wZW5kaW5nRm9jdXMoKTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XG4gICAgaWYgKHByZXZQcm9wcy52YWx1ZSAhPT0gdGhpcy5wcm9wcy52YWx1ZSkge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIHZhbHVlOiBjcmVhdGVTbGF0ZVZhbHVlKHRoaXMucHJvcHMudmFsdWUsIHtcbiAgICAgICAgICB2b2lkQ29kZUJsb2NrOiAhIXRoaXMuY29kZUJsb2NrQ29tcG9uZW50LFxuICAgICAgICAgIHJlbWFya1BsdWdpbnM6IHRoaXMucmVtYXJrUGx1Z2lucyxcbiAgICAgICAgfSksXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVNYXJrQ2xpY2sgPSB0eXBlID0+IHtcbiAgICB0aGlzLmVkaXRvci50b2dnbGVNYXJrKHR5cGUpLmZvY3VzKCk7XG4gIH07XG5cbiAgaGFuZGxlQmxvY2tDbGljayA9IHR5cGUgPT4ge1xuICAgIHRoaXMuZWRpdG9yLnRvZ2dsZUJsb2NrKHR5cGUpLmZvY3VzKCk7XG4gIH07XG5cbiAgaGFuZGxlTGlua0NsaWNrID0gKCkgPT4ge1xuICAgIHRoaXMuZWRpdG9yLnRvZ2dsZUxpbmsob2xkVXJsID0+XG4gICAgICB3aW5kb3cucHJvbXB0KHRoaXMucHJvcHMudCgnZWRpdG9yLmVkaXRvcldpZGdldHMubWFya2Rvd24ubGlua1Byb21wdCcpLCBvbGRVcmwpLFxuICAgICk7XG4gIH07XG5cbiAgaGFzTWFyayA9IHR5cGUgPT4gdGhpcy5lZGl0b3IgJiYgdGhpcy5lZGl0b3IuaGFzTWFyayh0eXBlKTtcbiAgaGFzSW5saW5lID0gdHlwZSA9PiB0aGlzLmVkaXRvciAmJiB0aGlzLmVkaXRvci5oYXNJbmxpbmUodHlwZSk7XG4gIGhhc0Jsb2NrID0gdHlwZSA9PiB0aGlzLmVkaXRvciAmJiB0aGlzLmVkaXRvci5oYXNCbG9jayh0eXBlKTtcbiAgaGFzUXVvdGUgPSB0eXBlID0+IHRoaXMuZWRpdG9yICYmIHRoaXMuZWRpdG9yLmhhc1F1b3RlKHR5cGUpO1xuICBoYXNMaXN0SXRlbXMgPSB0eXBlID0+IHRoaXMuZWRpdG9yICYmIHRoaXMuZWRpdG9yLmhhc0xpc3RJdGVtcyh0eXBlKTtcblxuICBoYW5kbGVUb2dnbGVNb2RlID0gKCkgPT4ge1xuICAgIHRoaXMucHJvcHMub25Nb2RlKCdyYXcnKTtcbiAgfTtcblxuICBoYW5kbGVJbnNlcnRTaG9ydGNvZGUgPSBwbHVnaW5Db25maWcgPT4ge1xuICAgIHRoaXMuZWRpdG9yLmluc2VydFNob3J0Y29kZShwbHVnaW5Db25maWcpO1xuICB9O1xuXG4gIGhhbmRsZUNsaWNrQmVsb3dEb2N1bWVudCA9ICgpID0+IHtcbiAgICB0aGlzLmVkaXRvci5tb3ZlVG9FbmRPZkRvY3VtZW50KCk7XG4gIH07XG5cbiAgaGFuZGxlRG9jdW1lbnRDaGFuZ2UgPSBkZWJvdW5jZShlZGl0b3IgPT4ge1xuICAgIGNvbnN0IHsgb25DaGFuZ2UgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgcmF3ID0gZWRpdG9yLnZhbHVlLmRvY3VtZW50LnRvSlMoKTtcbiAgICBjb25zdCBtYXJrZG93biA9IHNsYXRlVG9NYXJrZG93bihyYXcsIHtcbiAgICAgIHZvaWRDb2RlQmxvY2s6IHRoaXMuY29kZUJsb2NrQ29tcG9uZW50LFxuICAgICAgcmVtYXJrUGx1Z2luczogdGhpcy5yZW1hcmtQbHVnaW5zLFxuICAgIH0pO1xuICAgIG9uQ2hhbmdlKG1hcmtkb3duKTtcbiAgfSwgMTUwKTtcblxuICBoYW5kbGVDaGFuZ2UgPSBlZGl0b3IgPT4ge1xuICAgIGlmICghdGhpcy5zdGF0ZS52YWx1ZS5kb2N1bWVudC5lcXVhbHMoZWRpdG9yLnZhbHVlLmRvY3VtZW50KSkge1xuICAgICAgdGhpcy5oYW5kbGVEb2N1bWVudENoYW5nZShlZGl0b3IpO1xuICAgIH1cbiAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IGVkaXRvci52YWx1ZSB9KTtcbiAgfTtcblxuICBwcm9jZXNzUmVmID0gcmVmID0+IHtcbiAgICB0aGlzLmVkaXRvciA9IHJlZjtcbiAgfTtcblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBvbkFkZEFzc2V0LCBnZXRBc3NldCwgY2xhc3NOYW1lLCBmaWVsZCwgaXNTaG93TW9kZVRvZ2dsZSwgdCwgaXNEaXNhYmxlZCB9ID0gdGhpcy5wcm9wcztcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdlxuICAgICAgICBjc3M9e2NvcmVDc3NgXG4gICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgICAgICBgfVxuICAgICAgPlxuICAgICAgICA8RWRpdG9yQ29udHJvbEJhcj5cbiAgICAgICAgICA8VG9vbGJhclxuICAgICAgICAgICAgb25NYXJrQ2xpY2s9e3RoaXMuaGFuZGxlTWFya0NsaWNrfVxuICAgICAgICAgICAgb25CbG9ja0NsaWNrPXt0aGlzLmhhbmRsZUJsb2NrQ2xpY2t9XG4gICAgICAgICAgICBvbkxpbmtDbGljaz17dGhpcy5oYW5kbGVMaW5rQ2xpY2t9XG4gICAgICAgICAgICBvblRvZ2dsZU1vZGU9e3RoaXMuaGFuZGxlVG9nZ2xlTW9kZX1cbiAgICAgICAgICAgIHBsdWdpbnM9e3RoaXMuZWRpdG9yQ29tcG9uZW50c31cbiAgICAgICAgICAgIG9uU3VibWl0PXt0aGlzLmhhbmRsZUluc2VydFNob3J0Y29kZX1cbiAgICAgICAgICAgIG9uQWRkQXNzZXQ9e29uQWRkQXNzZXR9XG4gICAgICAgICAgICBnZXRBc3NldD17Z2V0QXNzZXR9XG4gICAgICAgICAgICBidXR0b25zPXtmaWVsZC5nZXQoJ2J1dHRvbnMnKX1cbiAgICAgICAgICAgIGVkaXRvckNvbXBvbmVudHM9e2ZpZWxkLmdldCgnZWRpdG9yX2NvbXBvbmVudHMnKX1cbiAgICAgICAgICAgIGhhc01hcms9e3RoaXMuaGFzTWFya31cbiAgICAgICAgICAgIGhhc0lubGluZT17dGhpcy5oYXNJbmxpbmV9XG4gICAgICAgICAgICBoYXNCbG9jaz17dGhpcy5oYXNCbG9ja31cbiAgICAgICAgICAgIGhhc1F1b3RlPXt0aGlzLmhhc1F1b3RlfVxuICAgICAgICAgICAgaGFzTGlzdEl0ZW1zPXt0aGlzLmhhc0xpc3RJdGVtc31cbiAgICAgICAgICAgIGlzU2hvd01vZGVUb2dnbGU9e2lzU2hvd01vZGVUb2dnbGV9XG4gICAgICAgICAgICB0PXt0fVxuICAgICAgICAgICAgZGlzYWJsZWQ9e2lzRGlzYWJsZWR9XG4gICAgICAgICAgLz5cbiAgICAgICAgPC9FZGl0b3JDb250cm9sQmFyPlxuICAgICAgICA8Q2xhc3NOYW1lcz5cbiAgICAgICAgICB7KHsgY3NzLCBjeCB9KSA9PiAoXG4gICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17Y3goXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lLFxuICAgICAgICAgICAgICAgIGNzc2BcbiAgICAgICAgICAgICAgICAgICR7dmlzdWFsRWRpdG9yU3R5bGVzKHsgbWluaW1hbDogZmllbGQuZ2V0KCdtaW5pbWFsJykgfSl9XG4gICAgICAgICAgICAgICAgYCxcbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPFNsYXRlXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjc3NgXG4gICAgICAgICAgICAgICAgICBwYWRkaW5nOiAxNnB4IDIwcHggMDtcbiAgICAgICAgICAgICAgICBgfVxuICAgICAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLnZhbHVlfVxuICAgICAgICAgICAgICAgIHJlbmRlckJsb2NrPXt0aGlzLnJlbmRlckJsb2NrfVxuICAgICAgICAgICAgICAgIHJlbmRlcklubGluZT17dGhpcy5yZW5kZXJJbmxpbmV9XG4gICAgICAgICAgICAgICAgcmVuZGVyTWFyaz17dGhpcy5yZW5kZXJNYXJrfVxuICAgICAgICAgICAgICAgIHNjaGVtYT17dGhpcy5zY2hlbWF9XG4gICAgICAgICAgICAgICAgcGx1Z2lucz17dGhpcy5wbHVnaW5zfVxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUNoYW5nZX1cbiAgICAgICAgICAgICAgICByZWY9e3RoaXMucHJvY2Vzc1JlZn1cbiAgICAgICAgICAgICAgICBzcGVsbENoZWNrXG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDxJbnNlcnRpb25Qb2ludCBvbkNsaWNrPXt0aGlzLmhhbmRsZUNsaWNrQmVsb3dEb2N1bWVudH0gLz5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICl9XG4gICAgICAgIDwvQ2xhc3NOYW1lcz5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cbn1cbiJdfQ== */",
  toString: _EMOTION_STRINGIFIED_CSS_ERROR__
});

function createEmptyRawDoc() {
  const emptyText = _slate.Text.create('');

  const emptyBlock = _slate.Block.create({
    object: 'block',
    type: 'paragraph',
    nodes: [emptyText]
  });

  return {
    nodes: [emptyBlock]
  };
}

function createSlateValue(rawValue, {
  voidCodeBlock,
  remarkPlugins
}) {
  const rawDoc = rawValue && (0, _serializers.markdownToSlate)(rawValue, {
    voidCodeBlock,
    remarkPlugins
  });
  const rawDocHasNodes = !(0, _isEmpty2.default)((0, _get2.default)(rawDoc, 'nodes'));

  const document = _slate.Document.fromJSON(rawDocHasNodes ? rawDoc : createEmptyRawDoc());

  return _slate.Value.create({
    document
  });
}

function mergeMediaConfig(editorComponents, field) {
  // merge editor media library config to image components
  if (editorComponents.has('image')) {
    const imageComponent = editorComponents.get('image');
    const fields = imageComponent === null || imageComponent === void 0 ? void 0 : imageComponent.fields;

    if (fields) {
      imageComponent.fields = fields.update(fields.findIndex(f => f.get('widget') === 'image'), f => {
        // merge `media_library` config
        if (field.has('media_library')) {
          f = f.set('media_library', field.get('media_library').mergeDeep(f.get('media_library')));
        } // merge 'media_folder'


        if (field.has('media_folder') && !f.has('media_folder')) {
          f = f.set('media_folder', field.get('media_folder'));
        } // merge 'public_folder'


        if (field.has('public_folder') && !f.has('public_folder')) {
          f = f.set('public_folder', field.get('public_folder'));
        }

        return f;
      });
    }
  }
}

var _ref = process.env.NODE_ENV === "production" ? {
  name: "t5h4ts-Editor",
  styles: "position:relative;;label:Editor;"
} : {
  name: "t5h4ts-Editor",
  styles: "position:relative;;label:Editor;",
  map: "/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9NYXJrZG93bkNvbnRyb2wvVmlzdWFsRWRpdG9yLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQThOb0IiLCJmaWxlIjoiLi4vLi4vLi4vc3JjL01hcmtkb3duQ29udHJvbC9WaXN1YWxFZGl0b3IuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBJbW11dGFibGVQcm9wVHlwZXMgZnJvbSAncmVhY3QtaW1tdXRhYmxlLXByb3B0eXBlcyc7XG5pbXBvcnQgeyBmcm9tSlMgfSBmcm9tICdpbW11dGFibGUnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdAZW1vdGlvbi9zdHlsZWQnO1xuaW1wb3J0IHsgY3NzIGFzIGNvcmVDc3MsIENsYXNzTmFtZXMgfSBmcm9tICdAZW1vdGlvbi9jb3JlJztcbmltcG9ydCB7IGdldCwgaXNFbXB0eSwgZGVib3VuY2UgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgVmFsdWUsIERvY3VtZW50LCBCbG9jaywgVGV4dCB9IGZyb20gJ3NsYXRlJztcbmltcG9ydCB7IEVkaXRvciBhcyBTbGF0ZSB9IGZyb20gJ3NsYXRlLXJlYWN0JztcbmltcG9ydCB7IGxlbmd0aHMsIGZvbnRzLCB6SW5kZXggfSBmcm9tICduZXRsaWZ5LWNtcy11aS1kZWZhdWx0JztcblxuaW1wb3J0IHsgZWRpdG9yU3R5bGVWYXJzLCBFZGl0b3JDb250cm9sQmFyIH0gZnJvbSAnLi4vc3R5bGVzJztcbmltcG9ydCB7IHNsYXRlVG9NYXJrZG93biwgbWFya2Rvd25Ub1NsYXRlIH0gZnJvbSAnLi4vc2VyaWFsaXplcnMnO1xuaW1wb3J0IFRvb2xiYXIgZnJvbSAnLi4vTWFya2Rvd25Db250cm9sL1Rvb2xiYXInO1xuaW1wb3J0IHsgcmVuZGVyQmxvY2ssIHJlbmRlcklubGluZSwgcmVuZGVyTWFyayB9IGZyb20gJy4vcmVuZGVyZXJzJztcbmltcG9ydCBwbHVnaW5zIGZyb20gJy4vcGx1Z2lucy92aXN1YWwnO1xuaW1wb3J0IHNjaGVtYSBmcm9tICcuL3NjaGVtYSc7XG5cbmZ1bmN0aW9uIHZpc3VhbEVkaXRvclN0eWxlcyh7IG1pbmltYWwgfSkge1xuICByZXR1cm4gYFxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIG92ZXJmbG93OiBoaWRkZW47XG4gIG92ZXJmbG93LXg6IGF1dG87XG4gIGZvbnQtZmFtaWx5OiAke2ZvbnRzLnByaW1hcnl9O1xuICBtaW4taGVpZ2h0OiAke21pbmltYWwgPyAnYXV0bycgOiBsZW5ndGhzLnJpY2hUZXh0RWRpdG9yTWluSGVpZ2h0fTtcbiAgYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogMDtcbiAgYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6IDA7XG4gIGJvcmRlci10b3A6IDA7XG4gIG1hcmdpbi10b3A6IC0ke2VkaXRvclN0eWxlVmFycy5zdGlja3lEaXN0YW5jZUJvdHRvbX07XG4gIHBhZGRpbmc6IDA7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gIHotaW5kZXg6ICR7ekluZGV4LnpJbmRleDEwMH07XG5gO1xufVxuXG5jb25zdCBJbnNlcnRpb25Qb2ludCA9IHN0eWxlZC5kaXZgXG4gIGZsZXg6IDEgMSBhdXRvO1xuICBjdXJzb3I6IHRleHQ7XG5gO1xuXG5mdW5jdGlvbiBjcmVhdGVFbXB0eVJhd0RvYygpIHtcbiAgY29uc3QgZW1wdHlUZXh0ID0gVGV4dC5jcmVhdGUoJycpO1xuICBjb25zdCBlbXB0eUJsb2NrID0gQmxvY2suY3JlYXRlKHsgb2JqZWN0OiAnYmxvY2snLCB0eXBlOiAncGFyYWdyYXBoJywgbm9kZXM6IFtlbXB0eVRleHRdIH0pO1xuICByZXR1cm4geyBub2RlczogW2VtcHR5QmxvY2tdIH07XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVNsYXRlVmFsdWUocmF3VmFsdWUsIHsgdm9pZENvZGVCbG9jaywgcmVtYXJrUGx1Z2lucyB9KSB7XG4gIGNvbnN0IHJhd0RvYyA9IHJhd1ZhbHVlICYmIG1hcmtkb3duVG9TbGF0ZShyYXdWYWx1ZSwgeyB2b2lkQ29kZUJsb2NrLCByZW1hcmtQbHVnaW5zIH0pO1xuICBjb25zdCByYXdEb2NIYXNOb2RlcyA9ICFpc0VtcHR5KGdldChyYXdEb2MsICdub2RlcycpKTtcbiAgY29uc3QgZG9jdW1lbnQgPSBEb2N1bWVudC5mcm9tSlNPTihyYXdEb2NIYXNOb2RlcyA/IHJhd0RvYyA6IGNyZWF0ZUVtcHR5UmF3RG9jKCkpO1xuICByZXR1cm4gVmFsdWUuY3JlYXRlKHsgZG9jdW1lbnQgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtZXJnZU1lZGlhQ29uZmlnKGVkaXRvckNvbXBvbmVudHMsIGZpZWxkKSB7XG4gIC8vIG1lcmdlIGVkaXRvciBtZWRpYSBsaWJyYXJ5IGNvbmZpZyB0byBpbWFnZSBjb21wb25lbnRzXG4gIGlmIChlZGl0b3JDb21wb25lbnRzLmhhcygnaW1hZ2UnKSkge1xuICAgIGNvbnN0IGltYWdlQ29tcG9uZW50ID0gZWRpdG9yQ29tcG9uZW50cy5nZXQoJ2ltYWdlJyk7XG4gICAgY29uc3QgZmllbGRzID0gaW1hZ2VDb21wb25lbnQ/LmZpZWxkcztcblxuICAgIGlmIChmaWVsZHMpIHtcbiAgICAgIGltYWdlQ29tcG9uZW50LmZpZWxkcyA9IGZpZWxkcy51cGRhdGUoXG4gICAgICAgIGZpZWxkcy5maW5kSW5kZXgoZiA9PiBmLmdldCgnd2lkZ2V0JykgPT09ICdpbWFnZScpLFxuICAgICAgICBmID0+IHtcbiAgICAgICAgICAvLyBtZXJnZSBgbWVkaWFfbGlicmFyeWAgY29uZmlnXG4gICAgICAgICAgaWYgKGZpZWxkLmhhcygnbWVkaWFfbGlicmFyeScpKSB7XG4gICAgICAgICAgICBmID0gZi5zZXQoXG4gICAgICAgICAgICAgICdtZWRpYV9saWJyYXJ5JyxcbiAgICAgICAgICAgICAgZmllbGQuZ2V0KCdtZWRpYV9saWJyYXJ5JykubWVyZ2VEZWVwKGYuZ2V0KCdtZWRpYV9saWJyYXJ5JykpLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gbWVyZ2UgJ21lZGlhX2ZvbGRlcidcbiAgICAgICAgICBpZiAoZmllbGQuaGFzKCdtZWRpYV9mb2xkZXInKSAmJiAhZi5oYXMoJ21lZGlhX2ZvbGRlcicpKSB7XG4gICAgICAgICAgICBmID0gZi5zZXQoJ21lZGlhX2ZvbGRlcicsIGZpZWxkLmdldCgnbWVkaWFfZm9sZGVyJykpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBtZXJnZSAncHVibGljX2ZvbGRlcidcbiAgICAgICAgICBpZiAoZmllbGQuaGFzKCdwdWJsaWNfZm9sZGVyJykgJiYgIWYuaGFzKCdwdWJsaWNfZm9sZGVyJykpIHtcbiAgICAgICAgICAgIGYgPSBmLnNldCgncHVibGljX2ZvbGRlcicsIGZpZWxkLmdldCgncHVibGljX2ZvbGRlcicpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGY7XG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFZGl0b3IgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcbiAgICBjb25zdCBlZGl0b3JDb21wb25lbnRzID0gcHJvcHMuZ2V0RWRpdG9yQ29tcG9uZW50cygpO1xuICAgIHRoaXMuc2hvcnRjb2RlQ29tcG9uZW50cyA9IGVkaXRvckNvbXBvbmVudHMuZmlsdGVyKCh7IHR5cGUgfSkgPT4gdHlwZSA9PT0gJ3Nob3J0Y29kZScpO1xuICAgIHRoaXMuY29kZUJsb2NrQ29tcG9uZW50ID0gZnJvbUpTKGVkaXRvckNvbXBvbmVudHMuZmluZCgoeyB0eXBlIH0pID0+IHR5cGUgPT09ICdjb2RlLWJsb2NrJykpO1xuICAgIHRoaXMuZWRpdG9yQ29tcG9uZW50cyA9XG4gICAgICB0aGlzLmNvZGVCbG9ja0NvbXBvbmVudCB8fCBlZGl0b3JDb21wb25lbnRzLmhhcygnY29kZS1ibG9jaycpXG4gICAgICAgID8gZWRpdG9yQ29tcG9uZW50c1xuICAgICAgICA6IGVkaXRvckNvbXBvbmVudHMuc2V0KCdjb2RlLWJsb2NrJywgeyBsYWJlbDogJ0NvZGUgQmxvY2snLCB0eXBlOiAnY29kZS1ibG9jaycgfSk7XG5cbiAgICB0aGlzLnJlbWFya1BsdWdpbnMgPSBwcm9wcy5nZXRSZW1hcmtQbHVnaW5zKCk7XG5cbiAgICBtZXJnZU1lZGlhQ29uZmlnKHRoaXMuZWRpdG9yQ29tcG9uZW50cywgdGhpcy5wcm9wcy5maWVsZCk7XG4gICAgdGhpcy5yZW5kZXJCbG9jayA9IHJlbmRlckJsb2NrKHtcbiAgICAgIGNsYXNzTmFtZVdyYXBwZXI6IHByb3BzLmNsYXNzTmFtZSxcbiAgICAgIHJlc29sdmVXaWRnZXQ6IHByb3BzLnJlc29sdmVXaWRnZXQsXG4gICAgICBjb2RlQmxvY2tDb21wb25lbnQ6IHRoaXMuY29kZUJsb2NrQ29tcG9uZW50LFxuICAgIH0pO1xuICAgIHRoaXMucmVuZGVySW5saW5lID0gcmVuZGVySW5saW5lKCk7XG4gICAgdGhpcy5yZW5kZXJNYXJrID0gcmVuZGVyTWFyaygpO1xuICAgIHRoaXMuc2NoZW1hID0gc2NoZW1hKHsgdm9pZENvZGVCbG9jazogISF0aGlzLmNvZGVCbG9ja0NvbXBvbmVudCB9KTtcbiAgICB0aGlzLnBsdWdpbnMgPSBwbHVnaW5zKHtcbiAgICAgIGdldEFzc2V0OiBwcm9wcy5nZXRBc3NldCxcbiAgICAgIHJlc29sdmVXaWRnZXQ6IHByb3BzLnJlc29sdmVXaWRnZXQsXG4gICAgICB0OiBwcm9wcy50LFxuICAgICAgcmVtYXJrUGx1Z2luczogdGhpcy5yZW1hcmtQbHVnaW5zLFxuICAgIH0pO1xuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICB2YWx1ZTogY3JlYXRlU2xhdGVWYWx1ZSh0aGlzLnByb3BzLnZhbHVlLCB7XG4gICAgICAgIHZvaWRDb2RlQmxvY2s6ICEhdGhpcy5jb2RlQmxvY2tDb21wb25lbnQsXG4gICAgICAgIHJlbWFya1BsdWdpbnM6IHRoaXMucmVtYXJrUGx1Z2lucyxcbiAgICAgIH0pLFxuICAgIH07XG4gIH1cblxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIG9uQWRkQXNzZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgZ2V0QXNzZXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25DaGFuZ2U6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25Nb2RlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIHZhbHVlOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGZpZWxkOiBJbW11dGFibGVQcm9wVHlwZXMubWFwLmlzUmVxdWlyZWQsXG4gICAgZ2V0RWRpdG9yQ29tcG9uZW50czogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBnZXRSZW1hcmtQbHVnaW5zOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIGlzU2hvd01vZGVUb2dnbGU6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsXG4gICAgdDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgfTtcblxuICBzaG91bGRDb21wb25lbnRVcGRhdGUobmV4dFByb3BzLCBuZXh0U3RhdGUpIHtcbiAgICBpZiAoIXRoaXMuc3RhdGUudmFsdWUuZXF1YWxzKG5leHRTdGF0ZS52YWx1ZSkpIHJldHVybiB0cnVlO1xuXG4gICAgY29uc3QgcmF3ID0gbmV4dFN0YXRlLnZhbHVlLmRvY3VtZW50LnRvSlMoKTtcbiAgICBjb25zdCBtYXJrZG93biA9IHNsYXRlVG9NYXJrZG93bihyYXcsIHtcbiAgICAgIHZvaWRDb2RlQmxvY2s6IHRoaXMuY29kZUJsb2NrQ29tcG9uZW50LFxuICAgICAgcmVtYXJrUGx1Z2luczogdGhpcy5yZW1hcmtQbHVnaW5zLFxuICAgIH0pO1xuICAgIHJldHVybiBuZXh0UHJvcHMudmFsdWUgIT09IG1hcmtkb3duO1xuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgaWYgKHRoaXMucHJvcHMucGVuZGluZ0ZvY3VzKSB7XG4gICAgICB0aGlzLmVkaXRvci5mb2N1cygpO1xuICAgICAgdGhpcy5wcm9wcy5wZW5kaW5nRm9jdXMoKTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XG4gICAgaWYgKHByZXZQcm9wcy52YWx1ZSAhPT0gdGhpcy5wcm9wcy52YWx1ZSkge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIHZhbHVlOiBjcmVhdGVTbGF0ZVZhbHVlKHRoaXMucHJvcHMudmFsdWUsIHtcbiAgICAgICAgICB2b2lkQ29kZUJsb2NrOiAhIXRoaXMuY29kZUJsb2NrQ29tcG9uZW50LFxuICAgICAgICAgIHJlbWFya1BsdWdpbnM6IHRoaXMucmVtYXJrUGx1Z2lucyxcbiAgICAgICAgfSksXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVNYXJrQ2xpY2sgPSB0eXBlID0+IHtcbiAgICB0aGlzLmVkaXRvci50b2dnbGVNYXJrKHR5cGUpLmZvY3VzKCk7XG4gIH07XG5cbiAgaGFuZGxlQmxvY2tDbGljayA9IHR5cGUgPT4ge1xuICAgIHRoaXMuZWRpdG9yLnRvZ2dsZUJsb2NrKHR5cGUpLmZvY3VzKCk7XG4gIH07XG5cbiAgaGFuZGxlTGlua0NsaWNrID0gKCkgPT4ge1xuICAgIHRoaXMuZWRpdG9yLnRvZ2dsZUxpbmsob2xkVXJsID0+XG4gICAgICB3aW5kb3cucHJvbXB0KHRoaXMucHJvcHMudCgnZWRpdG9yLmVkaXRvcldpZGdldHMubWFya2Rvd24ubGlua1Byb21wdCcpLCBvbGRVcmwpLFxuICAgICk7XG4gIH07XG5cbiAgaGFzTWFyayA9IHR5cGUgPT4gdGhpcy5lZGl0b3IgJiYgdGhpcy5lZGl0b3IuaGFzTWFyayh0eXBlKTtcbiAgaGFzSW5saW5lID0gdHlwZSA9PiB0aGlzLmVkaXRvciAmJiB0aGlzLmVkaXRvci5oYXNJbmxpbmUodHlwZSk7XG4gIGhhc0Jsb2NrID0gdHlwZSA9PiB0aGlzLmVkaXRvciAmJiB0aGlzLmVkaXRvci5oYXNCbG9jayh0eXBlKTtcbiAgaGFzUXVvdGUgPSB0eXBlID0+IHRoaXMuZWRpdG9yICYmIHRoaXMuZWRpdG9yLmhhc1F1b3RlKHR5cGUpO1xuICBoYXNMaXN0SXRlbXMgPSB0eXBlID0+IHRoaXMuZWRpdG9yICYmIHRoaXMuZWRpdG9yLmhhc0xpc3RJdGVtcyh0eXBlKTtcblxuICBoYW5kbGVUb2dnbGVNb2RlID0gKCkgPT4ge1xuICAgIHRoaXMucHJvcHMub25Nb2RlKCdyYXcnKTtcbiAgfTtcblxuICBoYW5kbGVJbnNlcnRTaG9ydGNvZGUgPSBwbHVnaW5Db25maWcgPT4ge1xuICAgIHRoaXMuZWRpdG9yLmluc2VydFNob3J0Y29kZShwbHVnaW5Db25maWcpO1xuICB9O1xuXG4gIGhhbmRsZUNsaWNrQmVsb3dEb2N1bWVudCA9ICgpID0+IHtcbiAgICB0aGlzLmVkaXRvci5tb3ZlVG9FbmRPZkRvY3VtZW50KCk7XG4gIH07XG5cbiAgaGFuZGxlRG9jdW1lbnRDaGFuZ2UgPSBkZWJvdW5jZShlZGl0b3IgPT4ge1xuICAgIGNvbnN0IHsgb25DaGFuZ2UgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgcmF3ID0gZWRpdG9yLnZhbHVlLmRvY3VtZW50LnRvSlMoKTtcbiAgICBjb25zdCBtYXJrZG93biA9IHNsYXRlVG9NYXJrZG93bihyYXcsIHtcbiAgICAgIHZvaWRDb2RlQmxvY2s6IHRoaXMuY29kZUJsb2NrQ29tcG9uZW50LFxuICAgICAgcmVtYXJrUGx1Z2luczogdGhpcy5yZW1hcmtQbHVnaW5zLFxuICAgIH0pO1xuICAgIG9uQ2hhbmdlKG1hcmtkb3duKTtcbiAgfSwgMTUwKTtcblxuICBoYW5kbGVDaGFuZ2UgPSBlZGl0b3IgPT4ge1xuICAgIGlmICghdGhpcy5zdGF0ZS52YWx1ZS5kb2N1bWVudC5lcXVhbHMoZWRpdG9yLnZhbHVlLmRvY3VtZW50KSkge1xuICAgICAgdGhpcy5oYW5kbGVEb2N1bWVudENoYW5nZShlZGl0b3IpO1xuICAgIH1cbiAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IGVkaXRvci52YWx1ZSB9KTtcbiAgfTtcblxuICBwcm9jZXNzUmVmID0gcmVmID0+IHtcbiAgICB0aGlzLmVkaXRvciA9IHJlZjtcbiAgfTtcblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBvbkFkZEFzc2V0LCBnZXRBc3NldCwgY2xhc3NOYW1lLCBmaWVsZCwgaXNTaG93TW9kZVRvZ2dsZSwgdCwgaXNEaXNhYmxlZCB9ID0gdGhpcy5wcm9wcztcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdlxuICAgICAgICBjc3M9e2NvcmVDc3NgXG4gICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgICAgICBgfVxuICAgICAgPlxuICAgICAgICA8RWRpdG9yQ29udHJvbEJhcj5cbiAgICAgICAgICA8VG9vbGJhclxuICAgICAgICAgICAgb25NYXJrQ2xpY2s9e3RoaXMuaGFuZGxlTWFya0NsaWNrfVxuICAgICAgICAgICAgb25CbG9ja0NsaWNrPXt0aGlzLmhhbmRsZUJsb2NrQ2xpY2t9XG4gICAgICAgICAgICBvbkxpbmtDbGljaz17dGhpcy5oYW5kbGVMaW5rQ2xpY2t9XG4gICAgICAgICAgICBvblRvZ2dsZU1vZGU9e3RoaXMuaGFuZGxlVG9nZ2xlTW9kZX1cbiAgICAgICAgICAgIHBsdWdpbnM9e3RoaXMuZWRpdG9yQ29tcG9uZW50c31cbiAgICAgICAgICAgIG9uU3VibWl0PXt0aGlzLmhhbmRsZUluc2VydFNob3J0Y29kZX1cbiAgICAgICAgICAgIG9uQWRkQXNzZXQ9e29uQWRkQXNzZXR9XG4gICAgICAgICAgICBnZXRBc3NldD17Z2V0QXNzZXR9XG4gICAgICAgICAgICBidXR0b25zPXtmaWVsZC5nZXQoJ2J1dHRvbnMnKX1cbiAgICAgICAgICAgIGVkaXRvckNvbXBvbmVudHM9e2ZpZWxkLmdldCgnZWRpdG9yX2NvbXBvbmVudHMnKX1cbiAgICAgICAgICAgIGhhc01hcms9e3RoaXMuaGFzTWFya31cbiAgICAgICAgICAgIGhhc0lubGluZT17dGhpcy5oYXNJbmxpbmV9XG4gICAgICAgICAgICBoYXNCbG9jaz17dGhpcy5oYXNCbG9ja31cbiAgICAgICAgICAgIGhhc1F1b3RlPXt0aGlzLmhhc1F1b3RlfVxuICAgICAgICAgICAgaGFzTGlzdEl0ZW1zPXt0aGlzLmhhc0xpc3RJdGVtc31cbiAgICAgICAgICAgIGlzU2hvd01vZGVUb2dnbGU9e2lzU2hvd01vZGVUb2dnbGV9XG4gICAgICAgICAgICB0PXt0fVxuICAgICAgICAgICAgZGlzYWJsZWQ9e2lzRGlzYWJsZWR9XG4gICAgICAgICAgLz5cbiAgICAgICAgPC9FZGl0b3JDb250cm9sQmFyPlxuICAgICAgICA8Q2xhc3NOYW1lcz5cbiAgICAgICAgICB7KHsgY3NzLCBjeCB9KSA9PiAoXG4gICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17Y3goXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lLFxuICAgICAgICAgICAgICAgIGNzc2BcbiAgICAgICAgICAgICAgICAgICR7dmlzdWFsRWRpdG9yU3R5bGVzKHsgbWluaW1hbDogZmllbGQuZ2V0KCdtaW5pbWFsJykgfSl9XG4gICAgICAgICAgICAgICAgYCxcbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPFNsYXRlXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjc3NgXG4gICAgICAgICAgICAgICAgICBwYWRkaW5nOiAxNnB4IDIwcHggMDtcbiAgICAgICAgICAgICAgICBgfVxuICAgICAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLnZhbHVlfVxuICAgICAgICAgICAgICAgIHJlbmRlckJsb2NrPXt0aGlzLnJlbmRlckJsb2NrfVxuICAgICAgICAgICAgICAgIHJlbmRlcklubGluZT17dGhpcy5yZW5kZXJJbmxpbmV9XG4gICAgICAgICAgICAgICAgcmVuZGVyTWFyaz17dGhpcy5yZW5kZXJNYXJrfVxuICAgICAgICAgICAgICAgIHNjaGVtYT17dGhpcy5zY2hlbWF9XG4gICAgICAgICAgICAgICAgcGx1Z2lucz17dGhpcy5wbHVnaW5zfVxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUNoYW5nZX1cbiAgICAgICAgICAgICAgICByZWY9e3RoaXMucHJvY2Vzc1JlZn1cbiAgICAgICAgICAgICAgICBzcGVsbENoZWNrXG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDxJbnNlcnRpb25Qb2ludCBvbkNsaWNrPXt0aGlzLmhhbmRsZUNsaWNrQmVsb3dEb2N1bWVudH0gLz5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICl9XG4gICAgICAgIDwvQ2xhc3NOYW1lcz5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cbn1cbiJdfQ== */",
  toString: _EMOTION_STRINGIFIED_CSS_ERROR__
};

class Editor extends _react.default.Component {
  constructor(props) {
    super(props);

    _defineProperty(this, "handleMarkClick", type => {
      this.editor.toggleMark(type).focus();
    });

    _defineProperty(this, "handleBlockClick", type => {
      this.editor.toggleBlock(type).focus();
    });

    _defineProperty(this, "handleLinkClick", () => {
      this.editor.toggleLink(oldUrl => window.prompt(this.props.t('editor.editorWidgets.markdown.linkPrompt'), oldUrl));
    });

    _defineProperty(this, "hasMark", type => this.editor && this.editor.hasMark(type));

    _defineProperty(this, "hasInline", type => this.editor && this.editor.hasInline(type));

    _defineProperty(this, "hasBlock", type => this.editor && this.editor.hasBlock(type));

    _defineProperty(this, "hasQuote", type => this.editor && this.editor.hasQuote(type));

    _defineProperty(this, "hasListItems", type => this.editor && this.editor.hasListItems(type));

    _defineProperty(this, "handleToggleMode", () => {
      this.props.onMode('raw');
    });

    _defineProperty(this, "handleInsertShortcode", pluginConfig => {
      this.editor.insertShortcode(pluginConfig);
    });

    _defineProperty(this, "handleClickBelowDocument", () => {
      this.editor.moveToEndOfDocument();
    });

    _defineProperty(this, "handleDocumentChange", (0, _debounce2.default)(editor => {
      const {
        onChange
      } = this.props;
      const raw = editor.value.document.toJS();
      const markdown = (0, _serializers.slateToMarkdown)(raw, {
        voidCodeBlock: this.codeBlockComponent,
        remarkPlugins: this.remarkPlugins
      });
      onChange(markdown);
    }, 150));

    _defineProperty(this, "handleChange", editor => {
      if (!this.state.value.document.equals(editor.value.document)) {
        this.handleDocumentChange(editor);
      }

      this.setState({
        value: editor.value
      });
    });

    _defineProperty(this, "processRef", ref => {
      this.editor = ref;
    });

    const editorComponents = props.getEditorComponents();
    this.shortcodeComponents = editorComponents.filter(({
      type
    }) => type === 'shortcode');
    this.codeBlockComponent = (0, _immutable.fromJS)(editorComponents.find(({
      type
    }) => type === 'code-block'));
    this.editorComponents = this.codeBlockComponent || editorComponents.has('code-block') ? editorComponents : editorComponents.set('code-block', {
      label: 'Code Block',
      type: 'code-block'
    });
    this.remarkPlugins = props.getRemarkPlugins();
    mergeMediaConfig(this.editorComponents, this.props.field);
    this.renderBlock = (0, _renderers.renderBlock)({
      classNameWrapper: props.className,
      resolveWidget: props.resolveWidget,
      codeBlockComponent: this.codeBlockComponent
    });
    this.renderInline = (0, _renderers.renderInline)();
    this.renderMark = (0, _renderers.renderMark)();
    this.schema = (0, _schema.default)({
      voidCodeBlock: !!this.codeBlockComponent
    });
    this.plugins = (0, _visual.default)({
      getAsset: props.getAsset,
      resolveWidget: props.resolveWidget,
      t: props.t,
      remarkPlugins: this.remarkPlugins
    });
    this.state = {
      value: createSlateValue(this.props.value, {
        voidCodeBlock: !!this.codeBlockComponent,
        remarkPlugins: this.remarkPlugins
      })
    };
  }

  shouldComponentUpdate(nextProps, nextState) {
    if (!this.state.value.equals(nextState.value)) return true;
    const raw = nextState.value.document.toJS();
    const markdown = (0, _serializers.slateToMarkdown)(raw, {
      voidCodeBlock: this.codeBlockComponent,
      remarkPlugins: this.remarkPlugins
    });
    return nextProps.value !== markdown;
  }

  componentDidMount() {
    if (this.props.pendingFocus) {
      this.editor.focus();
      this.props.pendingFocus();
    }
  }

  componentDidUpdate(prevProps) {
    if (prevProps.value !== this.props.value) {
      this.setState({
        value: createSlateValue(this.props.value, {
          voidCodeBlock: !!this.codeBlockComponent,
          remarkPlugins: this.remarkPlugins
        })
      });
    }
  }

  render() {
    const {
      onAddAsset,
      getAsset,
      className,
      field,
      isShowModeToggle,
      t,
      isDisabled
    } = this.props;
    return (0, _core.jsx)("div", {
      css: _ref
    }, (0, _core.jsx)(_styles.EditorControlBar, null, (0, _core.jsx)(_Toolbar.default, {
      onMarkClick: this.handleMarkClick,
      onBlockClick: this.handleBlockClick,
      onLinkClick: this.handleLinkClick,
      onToggleMode: this.handleToggleMode,
      plugins: this.editorComponents,
      onSubmit: this.handleInsertShortcode,
      onAddAsset: onAddAsset,
      getAsset: getAsset,
      buttons: field.get('buttons'),
      editorComponents: field.get('editor_components'),
      hasMark: this.hasMark,
      hasInline: this.hasInline,
      hasBlock: this.hasBlock,
      hasQuote: this.hasQuote,
      hasListItems: this.hasListItems,
      isShowModeToggle: isShowModeToggle,
      t: t,
      disabled: isDisabled
    })), (0, _core.jsx)(_core.ClassNames, null, ({
      css,
      cx
    }) => (0, _core.jsx)("div", {
      className: cx(className, css`
                  ${visualEditorStyles({
        minimal: field.get('minimal')
      })}
                `)
    }, (0, _core.jsx)(_slateReact.Editor, {
      className: css`
                  padding: 16px 20px 0;
                `,
      value: this.state.value,
      renderBlock: this.renderBlock,
      renderInline: this.renderInline,
      renderMark: this.renderMark,
      schema: this.schema,
      plugins: this.plugins,
      onChange: this.handleChange,
      ref: this.processRef,
      spellCheck: true
    }), (0, _core.jsx)(InsertionPoint, {
      onClick: this.handleClickBelowDocument
    }))));
  }

}

exports.default = Editor;

_defineProperty(Editor, "propTypes", {
  onAddAsset: _propTypes.default.func.isRequired,
  getAsset: _propTypes.default.func.isRequired,
  onChange: _propTypes.default.func.isRequired,
  onMode: _propTypes.default.func.isRequired,
  className: _propTypes.default.string.isRequired,
  value: _propTypes.default.string,
  field: _reactImmutableProptypes.default.map.isRequired,
  getEditorComponents: _propTypes.default.func.isRequired,
  getRemarkPlugins: _propTypes.default.func.isRequired,
  isShowModeToggle: _propTypes.default.bool.isRequired,
  t: _propTypes.default.func.isRequired
});